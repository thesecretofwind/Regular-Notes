## 前端性能优化之域名发散和域名收敛

#### 域名发散：

为了突破浏览器的域名的并发限制（因为浏览器允许对每个域名的链接数是有上限的），所以一般将http静态资源存放在多个子域名，这样就可以利用浏览器的多线程并发下载能力

![常见的浏览器对每个域名的连接数的限制](C:\Users\Administrator\Desktop\markdown笔记\域名发散和域名收敛\image\1.jpg)

由上图可知，各个浏览器在同域名的并行连接数都有限制，借本上都是6个，所以pc时代对静态资源优化时，通常将静态资源分布在几个不同域，保证资源最完美的分域名存储，以提供最大并行度，让客户端加载静态资源更快

##### 浏览器并发限制原因解析

1.根本原因，是服务器的负载能力有限，流量过大会导致服务器过载继而崩溃，所以要对对浏览器的最大并发数（max connections）进行限制。如果每个用户的最大并发数不限制的话，服务器的负载能力会导致服务器的负载能力大幅下降

2.还有就是防止`DDos`攻击。因为最基本的`DDos`攻击利用合理的服务请求占用过多的资源，从而使合法用户无法得到服务的响应（因为如果哟黑客对服务器发起`DDos`攻击，通常就是控制傀儡电脑来与服务器建立空连接（有大量等待的TCP连接），占用服务器的资源，直至服务器崩溃）

#### 域名收敛：

将静态资源只放在同一域名下，而非域名发散的多个多个域名

##### 原因

因为域名发散是pc时代的产物，而现在进入了移动互联网时代，通过无线设备访问网址，app用户也占据了比较大的比重，所以考虑手机端的用户体验。首先考虑到手机的信号有时不稳定，网络容易降级，可能会从4g到3g，甚至于2g信号，此时的网络很差，而此时进行DNS耗时，尤其是使用域名发散增加域时，会给浏览器带来DNS解析的开销。此时，使用域名收敛效果更好。

#### http2.0

优势：

1. 多路复用。即连接共享，每一个request请求都是用作练肌肉共享机制的，一个request会被分配一个id，一个连接上可以有多个request，每个连接的request可以随机混杂在一起，接收方接收到请求后，可根据request的id将request归属到各自不同的服务端请求
2. 二进制分帧。在应用层（http/2）和传输层（`tcp/udp`）之间存在二进制分帧层，该层会把所有传输的信息转换为更小的消息和帧
3. 首部压缩。舍弃一些不必要的头信息，可以节省多余数据传输带来的等待时间和带宽
4. 服务端推送。服务端可以主动向客户端发起通信，并向客户端推送数据

