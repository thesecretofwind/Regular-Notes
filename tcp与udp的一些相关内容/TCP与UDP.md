##   TCP与UDP

### tcp与udp的区别

1. udp是无连接的，而tcp是面向连接的。即tcp传送数据前需建立tcp连接，数据传送完毕后释放tcp连接
2. udp是尽最大努力交付，而tcp是可靠性交付
3. udp支持一对一，一对多，多对多连接，而tcp连接只能是点对点的连接
4. udp报文头部是8字节，而tcp报文头部是20字节

### tcp与udp的应用场景

- TCP应用场景：
  效率要求相对低，但对准确性要求相对高的场景。因为传输中需要对数据确认、重发、排序等操作，相比之下效率没有UDP高。举几个例子：文件传输（准确高要求高、但是速度可以相对慢）、接受邮件、远程登录。
- UDP应用场景：
  效率要求相对高，对准确性要求相对低的场景。举几个例子：QQ聊天、在线视频、网络语音电话（即时通讯，速度要求高，但是出现偶尔断续不是太大问题，并且此处完全不可以使用重发机制）、广播通信（广播、多播）。

### tcp可靠传输的工作原理

#### 1.无差错的情况（停止等待协议）

发送方向接收方发送一个分组，每个分组设置有一个超时计时器，等到接受方接受到对下一个分组的确认，才发送下一个分组，如果因网络阻塞，接收方接受不到分组或者向下一个分组的确认无法到底发送方，时计时器到期，重传分组

如果在重传分组前，上一个分组因网络阻塞后，比重传分组之前到达，则后续的分组丢弃。

#### 2.滑动窗口协议（ARQ协议）

发送方维持一个发送窗口，位于发送窗口的分组会连续发送出去，而接收方是采用累积确认的方式，对按序到达的最后一个分组发送确认，也就表明到这个分组为止的所有分组都已正确收到

### tcp的流量控制

流量控制：让发送方的发送效率不要太快，要让接收方来得及接收（发送方的发送窗口不能比接收方的接收窗口大）

糊涂窗口综合征：

tcp接收方的缓存已经满了，而交互式进程一次只能从接收缓存中读取一个字节（接收缓存空间中腾出一字节空间），然后向发送方发送确认，并把窗口设置为1字节（但发送的数据报长度是41字节，ip数据包头部，tcp数据包头部均是20字节），而发送方发送一个字节数据，如此循环往复，数据传递效率低下

解决：

让接收方等待一段时间，使得或者接收缓存已有足够空间容纳一个最长的报文段，或者等到接受缓存已有一半的空闲空间。

### tcp的拥塞控制方法(基于窗口的拥塞控制)

1. 慢开始

   **发送方控制拥塞窗口的原则:**

   要网络没有出现拥塞,拥塞窗口就可以增大一些,以便把更多的分组发送出去,提高网络的利用率

   **慢开始算法的思路:**

   当主机开始发送数据时,偶遇并不清楚网络的负荷情况,所以如果立即将大量的数据字节注入网络,那么就有可能引起网络堵塞.因此,较好的方式就是先探测一下,即由小到大逐渐增大发送窗口(由小到大逐渐增大拥塞窗口的数值)

   **慢开始规定:**

   在每收到一个对新的报文段的确认后,就可以把拥塞窗口增加最多一个SMSS(sender maximum segment size),

   注:实际上tcp是一字节数作为窗口大小的单位

   所以,使用了慢开始算法,每经过一个传输轮次(往返事件RTT,即发送拥塞窗口的所有字节,并收到对有序到达的最后一个字节的确认(如果是累积确认的话)),拥塞窗口cwnd(congestion window)就加倍

    **慢开始门限(ssthresh):**

   当 cwnd < ssthresh时,使用慢开始算法

   当cwnd > ssthresh时,改用拥塞避免算法

   当cwnd = ssthresh时,既可以使用慢开始算法,也可以使用拥塞避免算法

   **拥塞避免算法思路**

   让拥塞窗口cwnd缓慢的增大,即每经过一个往返时间RTT就把发送方的拥塞窗口cwnd+1,而不是先慢开始阶段那样加倍增长,有**加法增大**的特点

   (把拥塞窗口控制为线性增长,使网络比较不同堵塞)

   如果遇到超时情况,发送方判断网络堵塞,将慢开始门限设置为超时时的拥塞窗口cwnd的一般,然后开启慢开始算法,增加到慢开始门限ssthresh后使用拥塞避免算法

   如果遇到了发送方接受到了3个对同一个报文(序号)的确认,即ACK-3,使用快重传算算法,让发送方尽早知道发生了个别报文段的丢失.即,要求接收方不要等待自己发送数据时才进行捎带确认,而是立即发送确认,即使收到了失序的报文段也要立即发出对已接收到的报文段的重复确认.

   此时,采用快恢复算法,发将送窗口会降低为出现三次确认的拥塞窗口的一半,而后开启拥塞避免,线性增加发送窗口的大小







